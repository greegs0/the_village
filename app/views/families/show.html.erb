<%= render 'shared/navbar' %>

<!-- Main Content -->
<div class="container-fluid px-4 px-lg-5 py-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="h2 mb-2">Bienvenue dans votre Village</h1>
    <p class="text-secondary">Voici un aperÃ§u de votre journÃ©e</p>
  </div>

  <!-- Stats Cards -->
  <div class="row g-3 g-md-4 mb-4">
    <div class="col-6 col-lg-3">
      <%= link_to tasks_path, class: "text-decoration-none" do %>
        <div class="card border rounded-4 h-100">
          <div class="card-body p-3 p-md-4 d-flex justify-content-between align-items-center">
            <div>
              <p class="text-secondary small mb-1">TÃ¢ches en cours</p>
              <h3 class="h2 mb-0 text-dark"><%= @tasks.where(status: [false, nil]).count %></h3>
            </div>
            <div class="text-primary fs-1">â³</div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card border rounded-4 h-100">
        <div class="card-body p-3 p-md-4 d-flex justify-content-between align-items-center">
          <div>
            <p class="text-secondary small mb-1">Ã‰vÃ©nements cette semaine</p>
            <h3 class="h2 mb-0"><%= @events.count %></h3>
          </div>
          <div class="text-primary fs-1">ğŸ“…</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card border rounded-4 h-100">
        <div class="card-body p-3 p-md-4 d-flex justify-content-between align-items-center">
          <div>
            <p class="text-secondary small mb-1">Membres actifs</p>
            <h3 class="h2 mb-0"><%= Person.count %></h3>
          </div>
          <div class="text-primary fs-1">ğŸ‘¥</div>
        </div>
      </div>
    </div>
    <div class="col-6 col-lg-3">
      <div class="card border rounded-4 h-100">
        <div class="card-body p-3 p-md-4 d-flex justify-content-between align-items-center">
          <div>
            <p class="text-secondary small mb-1">Documents partagÃ©s</p>
            <h3 class="h2 mb-0">42</h3>
          </div>
          <div class="text-primary fs-1">ğŸ“„</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Village Assistant -->
  <div class="card border-0 rounded-4 mb-4 overflow-hidden shadow-sm">
    <div class="card-header border-0 p-3" style="background: linear-gradient(90deg, #6366f1 0%, #a855f7 50%, #f97316 100%);">
      <div class="d-flex align-items-center">
        <div class="bg-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
          <span style="font-size: 18px;">ğŸ˜ï¸</span>
        </div>
        <div>
          <h6 class="mb-0 text-white fw-medium">Village Assistant</h6>
          <small class="text-white opacity-75" style="font-size: 11px;">Toujours lÃ  pour vous aider</small>
        </div>
      </div>
    </div>
    <div class="card-body p-3 bg-white">
      <div class="d-flex mb-3">
        <div class="me-2">
          <div class="rounded-circle d-flex align-items-center justify-content-center"
                style="width: 28px; height: 28px; background: linear-gradient(135deg, #a855f7 0%, #f97316 100%);">
            <span style="font-size: 14px;">ğŸ˜ï¸</span>
          </div>
        </div>
        <div class="flex-grow-1">
          <div class="bg-light rounded-3 p-2">
            <p class="mb-1" style="font-size: 13px; line-height: 1.4;">
              Bonjour ! Je suis l'assistant de The Village. Comment puis-je vous aider aujourd'hui ?
              Vous pouvez me demander de crÃ©er des tÃ¢ches, planifier des Ã©vÃ©nements, envoyer des messages Ã  votre famille, ou obtenir des informations sur votre communautÃ©.
            </p>
            <small class="text-muted" style="font-size: 11px;">09:28</small>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="d-flex flex-wrap gap-2 mb-3">
        <button class="btn btn-sm rounded-pill" style="background: linear-gradient(90deg, #dbeafe 0%, #f3e8ff 100%); border: none; font-size: 11px; padding: 4px 12px;">
          ğŸ“… CrÃ©er un Ã©vÃ©nement famille
        </button>
        <button class="btn btn-sm rounded-pill" style="background: linear-gradient(90deg, #dbeafe 0%, #f3e8ff 100%); border: none; font-size: 11px; padding: 4px 12px;">
          âœ… Ajouter une nouvelle tÃ¢che
        </button>
        <button class="btn btn-sm rounded-pill" style="background: linear-gradient(90deg, #dbeafe 0%, #f3e8ff 100%); border: none; font-size: 11px; padding: 4px 12px;">
          ğŸ’¬ Envoyer un message au groupe
        </button>
        <button class="btn btn-sm rounded-pill" style="background: linear-gradient(90deg, #dbeafe 0%, #f3e8ff 100%); border: none; font-size: 11px; padding: 4px 12px;">
          ğŸ“Š Voir mes statistiques
        </button>
      </div>

      <!-- Input -->
      <div class="rounded-3 p-2" style="background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #1e293b 100%); box-shadow: inset 0px 2px 4px rgba(0,0,0,0.05);">
        <div class="d-flex align-items-center gap-1">
          <button class="btn btn-sm btn-link text-white p-1" style="font-size: 16px;">ğŸ“</button>
          <button class="btn btn-sm btn-link text-white p-1" style="font-size: 16px;">ğŸ¤</button>
          <input type="text" class="form-control form-control-sm bg-transparent border-0 text-white"
                  placeholder="Demandez Ã  Village de crÃ©er un tableau de bord..."
                  style="font-size: 13px; padding: 6px 8px;">
          <button class="btn btn-sm btn-link text-white p-1" style="font-size: 16px;">ğŸ˜Š</button>
          <button class="btn btn-sm btn-primary rounded-circle d-flex align-items-center justify-content-center"
                  style="width: 28px; height: 28px; padding: 0;">
            <span style="font-size: 14px;">â¤</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="row g-4 mb-4">
    <!-- Upcoming Events -->
    <div class="col-lg-6">
      <div class="card border rounded-4 h-100">
        <div class="card-body p-3 p-md-4">
          <h5 class="mb-1">Ã‰vÃ©nements Ã  venir</h5>
          <p class="text-secondary small mb-4">Vos prochains rendez-vous et activitÃ©s</p>

          <% if @events.any? %>
            <% @events.each do |event| %>
              <div class="d-flex justify-content-between align-items-start bg-light rounded-3 p-3 mb-3">
                <div class="flex-grow-1">
                  <h6 class="mb-1">
                    <% if event.event_icon.present? %>
                      <span class="me-1"><%= event.event_icon %></span>
                    <% end %>
                    <%= event.title %>
                  </h6>
                  <p class="text-secondary small mb-0">
                    <span class="me-2">ğŸ•</span>
                    <%= l(event.start_date, format: :long) %>
                    <% if event.time.present? %>
                      , <%= event.time.strftime("%H:%M") %>
                    <% end %>
                  </p>
                  <% if event.location.present? %>
                    <p class="text-secondary small mb-0">
                      <span class="me-2">ğŸ“</span><%= event.location %>
                    </p>
                  <% end %>
                </div>
                <% if event.event_type.present? %>
                  <span class="badge <%= event.badge_class || 'bg-secondary' %>">
                    <%= event.event_type %>
                  </span>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <p class="text-center text-muted py-4">Aucun Ã©vÃ©nement Ã  venir pour le moment</p>
          <% end %>

          <%= link_to "Voir tout le calendrier", family_family_events_path(@family), class: "btn btn-outline-secondary w-100" %>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-lg-6">
      <div class="card border rounded-4 h-100">
        <div class="card-body p-3 p-md-4">
          <h5 class="mb-1">ActivitÃ© rÃ©cente</h5>
          <p class="text-secondary small mb-4">Ce qui s'est passÃ© dans votre village</p>

          <% if @recent_completed_tasks.any? %>
            <% @recent_completed_tasks.each do |task| %>
              <div class="d-flex mb-3">
                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center me-3"
                      style="width: 40px; height: 40px;">
                  <span class="fw-medium"><%= task.assignee.name.first.upcase %></span>
                </div>
                <div class="flex-grow-1">
                  <p class="mb-1 small">
                    <strong><%= task.assignee.name %></strong> a complÃ©tÃ© la tÃ¢che
                    <%= link_to task.name, tasks_path, class: "text-primary text-decoration-none" %>
                  </p>
                  <small class="text-muted"><%= time_ago_in_words(task.updated_at) %></small>
                </div>
              </div>
            <% end %>
          <% else %>
            <p class="text-center text-muted py-4">Aucune activitÃ© rÃ©cente pour le moment</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Community Event Banner -->
  <div class="card border rounded-4 mb-4 bg-gradient-light">
    <div class="card-body p-3 p-md-4 d-flex flex-column flex-md-row align-items-center gap-3">
      <div class="fs-1">ğŸŒ</div>
      <div class="flex-grow-1">
        <h5 class="mb-1">CrÃ©er un Ã©vÃ©nement de rÃ©gion</h5>
        <p class="text-secondary mb-0 small">
          Organisez un Ã©vÃ©nement communautaire et invitez vos voisins ! CrÃ©ez des liens avec votre quartier.
        </p>
      </div>
      <%= link_to "DÃ©couvrir les Ã©vÃ©nements", events_path, class: "btn btn-primary" %>
    </div>
  </div>

  <!-- Task Progress Chart -->
  <div class="card border rounded-4 mb-4">
    <div class="card-body p-3 p-md-4">
      <h5 class="mb-1">Progression des tÃ¢ches hebdomadaires</h5>
      <p class="text-secondary small mb-4">
        <% if @weekly_total > 0 %>
          Votre famille a complÃ©tÃ© <%= @weekly_percentage %>% des tÃ¢ches cette semaine
        <% else %>
          Aucune tÃ¢che planifiÃ©e cette semaine
        <% end %>
      </p>

      <div class="row align-items-center mb-4">
        <div class="col-md-6">
          <div class="text-center mb-3">
            <div class="position-relative d-inline-block">
              <% stroke_offset = @weekly_total > 0 ? (502 * (100 - @weekly_percentage) / 100).round : 502 %>
              <svg width="200" height="200" viewBox="0 0 200 200">
                <circle cx="100" cy="100" r="80" fill="none" stroke="#e5e7eb" stroke-width="20"/>
                <circle cx="100" cy="100" r="80" fill="none" stroke="#10b981" stroke-width="20"
                        stroke-dasharray="502" stroke-dashoffset="<%= stroke_offset %>" transform="rotate(-90 100 100)"/>
              </svg>
              <div class="position-absolute top-50 start-50 translate-middle text-center">
                <div class="h2 mb-0"><%= @weekly_percentage %>%</div>
                <small class="text-muted">ComplÃ©tÃ©es</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
              <div class="rounded" style="width: 12px; height: 12px; background-color: #10b981;"></div>
              <span class="ms-2 small">ComplÃ©tÃ©es: <%= @weekly_completed %></span>
            </div>
            <div class="d-flex align-items-center mb-2">
              <div class="rounded" style="width: 12px; height: 12px; background-color: #f59e0b;"></div>
              <span class="ms-2 small">En cours: <%= @weekly_ongoing %></span>
            </div>
            <div class="d-flex align-items-center">
              <div class="rounded" style="width: 12px; height: 12px; background-color: #ef4444;"></div>
              <span class="ms-2 small">En retard: <%= @weekly_overdue %></span>
            </div>
          </div>
        </div>
      </div>

      <%= link_to "GÃ©rer les tÃ¢ches", tasks_path, class: "btn btn-dark w-100" %>
    </div>
  </div>
</div>
