<!-- Event Card -->
<div class="col-lg-6">
  <div class="card event-card rounded-4 h-100">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <div class="d-flex gap-2 mb-2">
            <span class="badge category-badge"><%= event.category %></span>
            <span class="badge participants-badge">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
              <%= event.participations_count %>/<%= event.max_participations %>
            </span>
          </div>
          <h5 class="mb-0 fw-semibold"><%= event.name %></h5>
        </div>
        <button type="button" class="btn btn-sm btn-status" onclick="VillageModal.open('participantsModal<%= event.id %>')">Inscrit</button>
      </div>

      <div class="d-flex flex-column gap-2 mb-3">
        <div class="d-flex align-items-center text-secondary small">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" class="me-2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <%= event.date %>
        </div>
        <div class="d-flex align-items-center text-secondary small">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" class="me-2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
          <%= event.place %>
          <% if event.has_coordinates? %>
            <a href="#" class="ms-2 text-decoration-none" style="color: #667eea; font-weight: 500;" onclick="document.querySelector('button[data-bs-target=&quot;#mapView&quot;]').click(); return false;">
              <small>Voir sur la carte</small>
            </a>
          <% end %>
        </div>
      </div>

      <p class="text-secondary small mb-3">
        <%= event.description %>
      </p>

      <div class="d-flex justify-content-between align-items-center pt-3 border-top" style="border-color: rgba(102, 126, 234, 0.1) !important;">
        <div class="d-flex align-items-center gap-2">
          <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <span class="small fw-medium text-white"><%= event.user.name.split.map(&:first).join %></span>
          </div>
          <div>
            <div class="small text-secondary">Organisé par</div>
            <div class="small fw-medium"><%= event.user.name %></div>
          </div>
        </div>
        <% if event.user == current_user %>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-edit-event" onclick="VillageModal.open('editEventModal<%= event.id %>')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Modifier
            </button>
            <%= link_to event_path(event), data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr de vouloir supprimer cet événement ?" }, class: "btn btn-sm btn-delete-event" do %>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
              Supprimer
            <% end %>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</div>

<!-- Modal Participants -->
<%= render "participants_modal", event: event %>

<!-- Modal Edit (si propriétaire) -->
<% if event.user == current_user %>
  <%= render "edit_modal", event: event %>
<% end %>
