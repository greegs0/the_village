<div class="today-widget" id="sidebar-today-widget">
  <div class="today-widget-header">
    <div class="today-icon-title">
      <i class="fas fa-calendar-day"></i>
      <span>Aujourd'hui</span>
    </div>
    <span class="today-date"><%= l(Date.today, format: :short) %></span>
  </div>

  <!-- Tasks summary -->
  <div class="today-summary-block">
    <div class="summary-title">
      <i class="fas fa-tasks"></i>
      <span>Tâches</span>
    </div>
    <% if defined?(sidebar_today_tasks) && sidebar_today_tasks&.any? %>
      <div class="summary-items">
        <% sidebar_today_tasks.first(3).each do |task| %>
          <div class="summary-item task-item" data-task-id="<%= task.id %>">
            <%= button_to toggle_status_family_task_path(current_user.family, task),
                method: :patch,
                class: "task-checkbox #{task.status ? 'checked' : ''}",
                data: { turbo_frame: "_top" },
                form: { data: { turbo: true } } do %>
              <% if task.status %>
                <i class="fas fa-check"></i>
              <% end %>
            <% end %>
            <%= link_to task.name.truncate(28), family_task_path(current_user.family, task), class: "item-text" %>
          </div>
        <% end %>
        <% if sidebar_today_tasks.count > 3 %>
          <div class="summary-more">
            <%= link_to "+#{sidebar_today_tasks.count - 3} de plus", family_tasks_path(current_user.family) %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="summary-empty">
        <i class="fas fa-check-circle"></i>
        <span>Rien aujourd'hui</span>
      </div>
    <% end %>
  </div>

  <!-- Events summary -->
  <div class="today-summary-block">
    <div class="summary-title">
      <i class="fas fa-calendar"></i>
      <span>Événements</span>
    </div>
    <% if defined?(sidebar_today_events) && sidebar_today_events&.any? %>
      <div class="summary-items">
        <% sidebar_today_events.first(2).each do |event| %>
          <%= link_to family_family_event_path(current_user.family, event), class: "summary-item event-item" do %>
            <span class="event-dot" style="background-color: <%= event.event_type_color || '#667eea' %>;"></span>
            <span class="item-text"><%= event.title.truncate(25) %></span>
          <% end %>
        <% end %>
        <% if sidebar_today_events.count > 2 %>
          <div class="summary-more">
            <%= link_to "+#{sidebar_today_events.count - 2} de plus", family_family_events_path(current_user.family) %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="summary-empty">
        <i class="fas fa-calendar-check"></i>
        <span>Rien prévu</span>
      </div>
    <% end %>
  </div>
</div>
